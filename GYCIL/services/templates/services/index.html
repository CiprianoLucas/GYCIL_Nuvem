{% extends 'base.html' %}
{% block title %}
  Serviços
{% endblock %}
{% load static %}
{% block head %}
  <script src="{% static 'services/js/index.js' %}"></script>
{% endblock %}

{% block content %}
{% with clients_url="/servicos/cliente" %}
  <h2 class="mb-3 text-center">Serviços solicitados</h2>
  <hr />
  <div class="table-responsive">
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>ID</th>
          <th>Categoria</th>
          <th class="d-none d-sm-table-cell">Estado</th>
          <th class="d-none d-sm-table-cell">Cidade</th>
          <th>Solicitante</th>
          <th class="d-none d-sm-table-cell">Abertura</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for service in services %}
          <tr>
            <td>{{ service.id }}</td>
            <td>{{ service.category.name }}</td>
            <td class="d-none d-sm-table-cell">{{ service.state }}</td>
            <td class="d-none d-sm-table-cell">{{ service.city }}</td>
            <td>{{ service.client.name }}</td>
            <td class="d-none d-sm-table-cell">{{ service.created_at }}</td>

            <td class="d-flex gap-1">
            
              <button data-url="{% url 'services:descriptions' service.id %}" type="button" class="btn btn-primary pe-3" data-bs-toggle="modal" data-bs-target="#serviceModal"><i class="bi bi-info-circle"></i></button>
           
            {% if form_action == clients_url %}
              <button data-url="{% url 'services:budgets_service' service.id %}" type="button" class="btn btn-success pe-3" data-bs-toggle="modal" data-bs-target="#budgetModal"><i class="bi bi-newspaper"></i></button>
            </td>
            {% endif %}
            
          </tr>
          {% empty %}
          <tr>
            <td colspan="8" class="text-center">Nenhum serviço disponível.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    {% if services.paginator.num_pages > 1 %}
      <nav aria-label="Paginação da página">
        <ul class="pagination justify-content-end">
          {% if services.has_previous %}
            <li class="page-item">
              <a href="?page={{ services.previous_page_number }}&q={{ request.GET.q }}" class="page-link" aria-label="Anterior">&laquo;</a>
            </li>
          {% endif %}
          <li class="page-item active">
            <span class="page-link">{{ services.number }}</span>
          </li>
          {% if services.has_next %}
            <li class="page-item">
              <a href="?page={{ services.next_page_number }}&q={{ request.GET.q }}" class="page-link" aria-label="Próximo">&raquo;</a>
            </li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  </div>

  <!-- Button trigger modal -->

  <!-- Modal -->
  <div class="modal fade modal-lg" id="serviceModal" tabindex="-1" aria-labelledby="serviceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="serviceModalLabel">SERVIÇO DE {{ service.category }} - {{ service.id }}</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div>
            <div>
              <h4>Cidade - Estado</h4>
            </div>
            <div>
              <p id="state_city"></p>
            </div>
          </div>
          <div>
            <div>
              <h4>Endereço</h4>
            </div>
            <div>
              <p id="street"></p>
            </div>
          </div>
          <div>
            <div>
              <h4>CEP</h4>
            </div>
            <div>
              <p id="cep"></p>
            </div>
          </div>
          <div>
            <div>
              <h4>Cliente</h4>
            </div>
            <div>
              <p id="client"></p>
            </div>
          </div>
          <div>
            <div>
              <h4>Descrição</h4>
            </div>
            <div>
              <p id="description"></p>
            </div>
          </div>
          <div>
            <div>
              <h4>Solicitado</h4>
            </div>
            <div>
              <p id="created_at"></p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary me-3" data-bs-dismiss="modal">Fechar</button>
          <div class="ms-auto">
            <a href=""  type="button" class="btn btn-danger ms-3" id="button_refuse">Recusar</a>
            <a href=""  type="button" class="btn btn-success ms-3" id="button_accept">Aceitar</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% if form_action == clients_url %}
  <div class="modal fade" id="budgetModal" tabindex="-1" aria-labelledby="budgetModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="budgetModalLabel">Fornecedores</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Empresa</th>
                <th>Valor</th>
                <th>Data início</th>
                <th>Opções</th>
              </tr>
            </thead>
            <tbody id="budgetTableBody">

            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-container="body" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-content="Bottom popover">
            Popover on bottom
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
  {% endwith %}
{% endblock %}
